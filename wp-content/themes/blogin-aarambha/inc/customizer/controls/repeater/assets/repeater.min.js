var bloginAarambhaRepeaterRow=function(e,t,i){"use strict";var a=this;this.rowIndex=e,this.container=t,this.label=i,this.header=this.container.find(".repeater-row-header"),this.header.on("click",function(){a.toggleMinimize()}),this.container.on("click",".repeater-row-remove",function(){a.remove()}),this.header.on("mousedown",function(){a.container.trigger("row:start-dragging")}),this.container.on("keyup change","input, select, textarea",function(e){a.container.trigger("row:update",[a.rowIndex,jQuery(e.target).data("field"),e.target])}),this.setRowIndex=function(e){this.rowIndex=e,this.container.attr("data-row",e),this.container.data("row",e),this.updateLabel()},this.toggleMinimize=function(){this.container.toggleClass("minimized"),this.header.find(".dashicons").toggleClass("dashicons-arrow-up").toggleClass("dashicons-arrow-down")},this.remove=function(){this.container.slideUp(300,function(){jQuery(this).detach()}),this.container.trigger("row:remove",[this.rowIndex])},this.updateLabel=function(){var e;"field"===this.label.type&&"function"==typeof(e=this.container.find('.repeater-field [data-field="'+this.label.field+'"]')).val&&""!==(e=e.val())?this.header.find(".repeater-row-label").text(e):this.header.find(".repeater-row-label").text(this.label.value+" "+(this.rowIndex+1))},this.updateLabel()};wp.customize.controlConstructor["blogin-aarambha-repeater"]=wp.customize.Control.extend({ready:function(){"use strict";var t,i=this,e=this.params.value;this.settingField=this.container.find("[data-customize-setting-link]").first(),this.setValue([],!1),this.repeaterFieldsContainer=this.container.find(".repeater-fields").first(),this.currentIndex=0,this.rows=[],t=!1,void 0!==this.params.choices.limit&&(t=!(this.params.choices.limit<=0)&&parseInt(this.params.choices.limit)),this.container.on("click","button.repeater-add",function(e){e.preventDefault(),!t||i.currentIndex<t?(i.addRow().toggleMinimize(),i.initColorPicker()):jQuery(i.selector+" .limit").addClass("highlight")}),this.container.on("click",".repeater-row-remove",function(e){i.currentIndex--,(!t||i.currentIndex<t)&&jQuery(i.selector+" .limit").removeClass("highlight")}),this.container.on("click keypress",".repeater-field-image .upload-button,.repeater-field-cropped_image .upload-button,.repeater-field-upload .upload-button",function(e){e.preventDefault(),i.$thisButton=jQuery(this),i.openFrame(e)}),this.container.on("click keypress",".repeater-field-image .remove-button,.repeater-field-cropped_image .remove-button",function(e){e.preventDefault(),i.$thisButton=jQuery(this),i.removeImage(e)}),this.container.on("click keypress",".repeater-field-upload .remove-button",function(e){e.preventDefault(),i.$thisButton=jQuery(this),i.removeFile(e)}),this.repeaterTemplate=_.memoize(function(){var t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e){return _.template(i.container.find(".customize-control-repeater-content").first().html(),null,t)(e)}}),e.length&&_.each(e,function(e){i.addRow(e),i.initColorPicker()}),this.setValue(e,!0,!0),this.repeaterFieldsContainer.sortable({handle:".repeater-row-header",update:function(e,t){i.sort()}})},openFrame:function(e){"use strict";wp.customize.utils.isKeydownButNotEnterEvent(e)||(this.$thisButton.closest(".repeater-field").hasClass("repeater-field-cropped_image")?this.initCropperFrame():this.initFrame(),this.frame.open())},initFrame:function(){"use strict";var e=this.getMimeType();this.frame=wp.media({states:[new wp.media.controller.Library({library:wp.media.query({type:e}),multiple:!1,date:!1})]}),this.frame.on("select",this.onSelect,this)},initCropperFrame:function(){"use strict";var i=this.$thisButton.siblings("input.hidden-field").attr("data-field"),e=this.getMimeType();"string"==typeof i&&""!==i&&"object"==typeof this.params.fields[i]&&"cropped_image"===this.params.fields[i].type&&["width","height","flex_width","flex_height"].forEach(function(e,t){void 0!==this.params.fields[i][e]&&(this.params[e]=this.params.fields[i][e])}.bind(this)),this.frame=wp.media({button:{text:"Select and Crop",close:!1},states:[new wp.media.controller.Library({library:wp.media.query({type:e}),multiple:!1,date:!1,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelectForCrop,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){"use strict";var e=this.frame.state().get("selection").first().toJSON();this.$thisButton.closest(".repeater-field").hasClass("repeater-field-upload")?this.setFileInRepeaterField(e):this.setImageInRepeaterField(e)},onSelectForCrop:function(){"use strict";var e=this.frame.state().get("selection").first().toJSON();this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):this.setImageInRepeaterField(e)},onCropped:function(e){"use strict";this.setImageInRepeaterField(e)},calculateImageSelectOptions:function(e,t){"use strict";var i=t.get("control"),a=!!parseInt(i.params.flex_width,10),r=!!parseInt(i.params.flex_height,10),s=e.get("width"),e=e.get("height"),n=parseInt(i.params.width,10),o=parseInt(i.params.height,10),l=n/o,h=s,d=e;return t.set("canSkipCrop",!i.mustBeCropped(a,r,n,o,s,e)),l<h/d?n=(o=d)*l:o=(n=h)/l,!(l={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:s,imageHeight:e,x1:t=(h-n)/2,y1:i=(d-o)/2,x2:n+t,y2:o+i})==r&&!1==a&&(l.aspectRatio=n+":"+o),!1==r&&(l.maxHeight=o),!1==a&&(l.maxWidth=n),l},mustBeCropped:function(e,t,i,a,r,s){"use strict";return(!0!==e||!0!==t)&&((!0!==e||a!==s)&&((!0!==t||i!==r)&&((i!==r||a!==s)&&!(r<=i))))},onSkippedCrop:function(){"use strict";var e=this.frame.state().get("selection").first().toJSON();this.setImageInRepeaterField(e)},setImageInRepeaterField:function(e){"use strict";var t=this.$thisButton.closest(".repeater-field-image,.repeater-field-cropped_image");t.find(".blogin-aarambha-image-attachment").html('<img src="'+e.url+'">').hide().slideDown("slow"),t.find(".hidden-field").val(e.id),this.$thisButton.text(this.$thisButton.data("alt-label")),t.find(".remove-button").show(),t.find("input, textarea, select").trigger("change"),this.frame.close()},setFileInRepeaterField:function(e){"use strict";var t=this.$thisButton.closest(".repeater-field-upload");t.find(".blogin-aarambha-file-attachment").html('<span class="file"><span class="dashicons dashicons-media-default"></span> '+e.filename+"</span>").hide().slideDown("slow"),t.find(".hidden-field").val(e.id),this.$thisButton.text(this.$thisButton.data("alt-label")),t.find(".upload-button").show(),t.find(".remove-button").show(),t.find("input, textarea, select").trigger("change"),this.frame.close()},getMimeType:function(){"use strict";var e=this.$thisButton.siblings("input.hidden-field").attr("data-field");return"string"==typeof e&&""!==e&&"object"==typeof this.params.fields[e]&&"upload"===this.params.fields[e].type&&void 0!==this.params.fields[e].mime_type?this.params.fields[e].mime_type:"image"},removeImage:function(e){"use strict";var t;wp.customize.utils.isKeydownButNotEnterEvent(e)||(t=(e=this.$thisButton.closest(".repeater-field-image,.repeater-field-cropped_image,.repeater-field-upload")).find(".upload-button"),e.find(".blogin-aarambha-image-attachment").slideUp("fast",function(){jQuery(this).show().html(jQuery(this).data("placeholder"))}),e.find(".hidden-field").val(""),t.text(t.data("label")),this.$thisButton.hide(),e.find("input, textarea, select").trigger("change"))},removeFile:function(e){"use strict";var t;wp.customize.utils.isKeydownButNotEnterEvent(e)||(t=(e=this.$thisButton.closest(".repeater-field-upload")).find(".upload-button"),e.find(".blogin-aarambha-file-attachment").slideUp("fast",function(){jQuery(this).show().html(jQuery(this).data("placeholder"))}),e.find(".hidden-field").val(""),t.text(t.data("label")),this.$thisButton.hide(),e.find("input, textarea, select").trigger("change"))},getValue:function(){"use strict";return JSON.parse(decodeURI(this.setting.get()))},setValue:function(e,t,i){"use strict";var r=e,s=[];i&&(jQuery.each(this.params.fields,function(e,t){"image"!==t.type&&"cropped_image"!==t.type&&"upload"!==t.type||s.push(e)}),jQuery.each(e,function(i,a){jQuery.each(s,function(e,t){void 0!==a[t]&&void 0!==a[t].id&&(r[i][t]=a[t].id)})})),this.setting.set(encodeURI(JSON.stringify(r))),t&&this.settingField.trigger("change")},addRow:function(e){"use strict";var t,r,i,s=this,a=s.repeaterTemplate(),n=this.getValue(),o={};if(a){if(t=jQuery.extend(!0,{},s.params.fields),e)for(i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(t[i].default=e[i]);for(i in t.index=this.currentIndex,a=a(t),(r=new bloginAarambhaRepeaterRow(s.currentIndex,jQuery(a).appendTo(s.repeaterFieldsContainer),s.params.row_label)).container.on("row:remove",function(e,t){s.deleteRow(t)}),r.container.on("row:update",function(e,t,i,a){s.updateField.call(s,e,t,i,a),r.updateLabel()}),this.rows[this.currentIndex]=r,t)t.hasOwnProperty(i)&&(o[i]=t[i].default);return n[this.currentIndex]=o,this.setValue(n,!0),this.currentIndex++,r}},sort:function(){"use strict";var i=this,e=this.repeaterFieldsContainer.find(".repeater-row"),a=[],r=i.getValue(),s=[],n=[];e.each(function(e,t){a.push(jQuery(t).data("row"))}),jQuery.each(a,function(e,t){s[e]=i.rows[t],s[e].setRowIndex(e),n[e]=r[t]}),i.rows=s,i.setValue(n)},deleteRow:function(e){"use strict";var t,i=this.getValue();for(t in i[e]&&this.rows[e]&&(delete i[e],delete this.rows[e],this.setValue(i,!0)),this.rows)this.rows.hasOwnProperty(t)&&this.rows[t]&&(this.rows[t].updateLabel(),0)},updateField:function(e,t,i,a){"use strict";var r,s;this.rows[t]&&this.params.fields[i]&&(r=this.params.fields[i].type,t=this.rows[t],s=this.getValue(),a=jQuery(a),void 0!==s[t.rowIndex][i]&&(s[t.rowIndex][i]="checkbox"===r?a.is(":checked"):a.val(),this.setValue(s,!0)))},initColorPicker:function(){"use strict";var r=this,e=r.container.find(".color-picker-hex"),t={},i=e.data("field");void 0!==i&&void 0!==r.params.fields[i]&&void 0!==r.params.fields[i].palettes&&"object"==typeof r.params.fields[i].palettes&&(t.palettes=r.params.fields[i].palettes),t.change=function(e,t){var e=jQuery(e.target),i=e.closest(".repeater-row").data("row"),a=r.getValue();a[i][e.data("field")]=t.color.toString(),r.setValue(a,!0)},0!==e.length&&e.wpColorPicker(t)}}),jQuery(document).ready(function(i){"use strict";i(document).on("click",".repeater-add",function(){i(".repeater-field").find('input[type="font"]').attr("placeholder","search icons")}),i(document).on("click",'input[type="font"]',function(){var t=i(this);!t.hasClass("ajax-running")&&t.siblings(".font-awesome-list").length<1&&i.ajax({type:"POST",url:ajaxurl,data:{action:"blogin_aarambha_get_fontawesome",blogin_aarambha_customize_nonce:blogin_aarambha_customize.nonce},beforeSend:function(){t.addClass("ajax-running")},success:function(e){t.after('<div class="font-awesome-list">'+e+"</div>"),t.removeClass("ajax-running")}})}),i(document).on("click",".font-group li",function(e){var t=i(this).attr("data-font");i(this).parent().parent().siblings('input[type="font"]').val(t),i(this).parent().parent().siblings('input[type="font"]').trigger("change"),i(this).parent().parent().remove(),e.preventDefault()}),i(document).on("keyup",'input[type="font"]',function(){var e=i(this).val(),t=new RegExp(e,"gi");i(this).next(".font-awesome-list").children(".font-group").children("li").show().not(function(){return t.test(i(this).find("i").attr("class"))}).hide()})});